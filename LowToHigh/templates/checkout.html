<!DOCTYPE html>
<html>
<head>
    <title>Checkout - LowToHigh</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/checkout.css') }}">
</head>
<body class="bg-light">

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" href="{{ url_for('home') }}">LowToHigh</a>
  </div>
</nav>

<!-- PAGE HEADER -->
<header class="py-5 text-center bg-white shadow-sm">
    <h1>Checkout ðŸ›’</h1>
    <p class="lead">Finalize your order, choose your table & pay securely</p>
</header>

<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">

            <!-- Basket Items -->
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-primary text-white">
                    Your Basket
                </div>
                <ul class="list-group list-group-flush">
                    {% for item in basket_items %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <img src="{{ url_for('static', filename=item.img) }}" class="me-3 checkout-item-img" alt="{{ item.name }}">
                            <div>
                                <h6 class="mb-0">{{ item.name }}</h6>
                                <small>Quantity: {{ item.quantity }}</small>
                            </div>
                        </div>
                        <span class="fw-bold">${{ item.price * item.quantity }}</span>
                    </li>
                    {% endfor %}
                </ul>
                <div class="card-footer d-flex justify-content-between">
                    <span>Total:</span>
                    <span class="fw-bold">${{ total }}</span>
                </div>
            </div>

            <!-- Checkout Form -->
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white">
                    Reservation & Payment
                </div>
                <div class="card-body">
                    <form method="POST" id="checkoutForm">

                        <!-- Reservation Info -->
                        <div class="mb-4">
                            <h5>Reservation Details</h5>
                            <div class="mb-3">
                                <label for="guests" class="form-label">Number of Guests</label>
                                <input type="number" class="form-control" id="guests" name="guests" min="1" required>
                            </div>
                            <div class="mb-3">
                                <label for="date" class="form-label">Date</label>
                                <input type="date" class="form-control" id="date" name="date" required>
                            </div>
                            <div class="mb-3">
                                <label for="time" class="form-label">Time</label>
                                <input type="time" class="form-control" id="time" name="time" required>
                            </div>
                            <div class="mb-3">
                                <label for="table" class="form-label">Choose Table</label>
                                <select class="form-select" id="table" name="table" required>
                                    {% for t in tables %}
                                    <option value="{{ t }}">Table {{ t }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <!-- Credit Card Section -->
                        <div class="mb-4">
                            <h5>Payment</h5>
                            <div class="credit-card-box p-3 shadow-sm rounded bg-white">
                                <div class="mb-3">
                                    <label for="ccname" class="form-label">Cardholder Name</label>
                                    <input type="text" class="form-control" id="ccname" name="ccname" placeholder="John Doe" required>
                                </div>
                                <div class="mb-3">
                                    <label for="ccnumber" class="form-label">Card Number</label>
                                    <input type="text" class="form-control" id="ccnumber" name="ccnumber" placeholder="1234 5678 9012 3456" maxlength="19" required>
                                    <small class="text-danger d-none" id="ccnumberError">Invalid card number</small>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="ccexp" class="form-label">Expiry Date</label>
                                        <input type="text" class="form-control" id="ccexp" name="ccexp" placeholder="MM/YY" maxlength="5" required>
                                        <small class="text-danger d-none" id="ccexpError">Invalid expiry</small>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="cccvv" class="form-label">CVV</label>
                                        <input type="text" class="form-control" id="cccvv" name="cccvv" placeholder="123" maxlength="3" required>
                                        <small class="text-danger d-none" id="cccvvError">Invalid CVV</small>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-end mt-2">
                                    <img src="{{ url_for('static', filename='images/Visa-logo-.png') }}" alt="Visa" class="me-2 card-logo">
                                    <img src="{{ url_for('static', filename='images/Mastercard-Logo.wine.png') }}" alt="MasterCard" class="card-logo">
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-success w-100">Confirm & Pay</button>
                    </form>
                </div>
            </div>

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Simple live validation
document.getElementById('checkoutForm').addEventListener('submit', function(e) {
    let valid = true;

    const ccnumber = document.getElementById('ccnumber');
    const ccexp = document.getElementById('ccexp');
    const cccvv = document.getElementById('cccvv');

    // Remove spaces for checking
    const ccnumVal = ccnumber.value.replace(/\s+/g, '');
    if (!/^\d{16}$/.test(ccnumVal)) {
        document.getElementById('ccnumberError').classList.remove('d-none');
        valid = false;
    } else {
        document.getElementById('ccnumberError').classList.add('d-none');
    }

    if (!/^(0[1-9]|1[0-2])\/\d{2}$/.test(ccexp.value)) {
        document.getElementById('ccexpError').classList.remove('d-none');
        valid = false;
    } else {
        document.getElementById('ccexpError').classList.add('d-none');
    }

    if (!/^\d{3}$/.test(cccvv.value)) {
        document.getElementById('cccvvError').classList.remove('d-none');
        valid = false;
    } else {
        document.getElementById('cccvvError').classList.add('d-none');
    }

    if (!valid) e.preventDefault();
});

// Auto-format card number 
document.getElementById('ccnumber').addEventListener('input', function(e){
    let val = e.target.value.replace(/\D/g, '');
    val = val.substring(0,16);
    val = val.replace(/(\d{4})/g, '$1 ').trim();
    e.target.value = val;
});

// Auto-format expiry (MM/YY)
document.getElementById('ccexp').addEventListener('input', function(e){
    let val = e.target.value.replace(/\D/g, '');
    if(val.length >= 3){
        val = val.substring(0,4);
        val = val.replace(/(\d{2})/, '$1/');
    }
    e.target.value = val;
});
</script>

</body>
</html>
